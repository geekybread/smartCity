{"ast":null,"code":"// frontend/src/services/api.js\nconst API_BASE = 'http://localhost:8000/api/auth';\n\n// Enhanced response handler\nconst handleResponse = async response => {\n  const contentType = response.headers.get('content-type');\n  let errorData;\n  try {\n    errorData = contentType !== null && contentType !== void 0 && contentType.includes('application/json') ? await response.json() : {\n      message: await response.text()\n    };\n  } catch {\n    errorData = {\n      message: 'Request failed'\n    };\n  }\n  if (!response.ok) {\n    const error = new Error(errorData.message || `HTTP ${response.status}`);\n    error.status = response.status;\n    error.data = errorData;\n    throw error;\n  }\n  return errorData; // Returns parsed JSON for successful responses\n};\n\n// Auth Services\nexport const login = async credentials => {\n  try {\n    const response = await fetch(`${API_BASE}/login/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(credentials),\n      credentials: 'include' // For session/cookie support if needed\n    });\n    const data = await handleResponse(response);\n    if (!data.token) {\n      throw new Error('No token received from server');\n    }\n    localStorage.setItem('token', data.token);\n    return data;\n  } catch (error) {\n    console.error('Login failed:', error);\n    throw new Error(error.message || 'Login failed. Please try again.');\n  }\n};\nexport const register = async userData => {\n  try {\n    const response = await fetch(`${API_BASE}/register/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        username: userData.username,\n        password: userData.password,\n        email: userData.email,\n        name: userData.name,\n        mobile: userData.mobile\n      })\n    });\n    return await handleResponse(response);\n  } catch (error) {\n    console.error('Registration failed:', error);\n    throw new Error(error.message || 'Registration failed. Please try again.');\n  }\n};\nexport const updateAccount = async updates => {\n  const token = localStorage.getItem('token');\n  if (!token) {\n    throw new Error('Authentication required. Please login.');\n  }\n  try {\n    const response = await fetch(`${API_BASE}/update/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Token ${token}`\n      },\n      body: JSON.stringify(updates)\n    });\n    const data = await handleResponse(response);\n\n    // Update stored user data if needed\n    if (data.user) {\n      const currentData = JSON.parse(localStorage.getItem('userData') || {});\n      localStorage.setItem('userData', JSON.stringify({\n        ...currentData,\n        ...data.user\n      }));\n    }\n    return data;\n  } catch (error) {\n    console.error('Update failed:', error);\n\n    // Auto-logout on 401\n    if (error.status === 401) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('userData');\n      window.dispatchEvent(new Event('unauthorized'));\n    }\n    throw new Error(error.message || 'Failed to update account.');\n  }\n};\nexport const logout = async () => {\n  const token = localStorage.getItem('token');\n  if (!token) return true;\n  try {\n    await fetch(`${API_BASE}/logout/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Token ${token}`\n      }\n    });\n    return true;\n  } catch (error) {\n    console.error('Logout failed:', error);\n    return false;\n  } finally {\n    // Always clear client-side auth\n    localStorage.removeItem('token');\n    localStorage.removeItem('userData');\n  }\n};\n\n// Auth state utilities\nexport const getAuthToken = () => localStorage.getItem('token');\nexport const isAuthenticated = () => !!getAuthToken();\n\n// Axios interceptor setup\nexport const configureAxios = () => {\n  const token = getAuthToken();\n  if (token) {\n    axios.defaults.headers.common['Authorization'] = `Token ${token}`;\n  }\n  axios.interceptors.response.use(response => response, error => {\n    var _error$response;\n    if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n      localStorage.removeItem('token');\n      window.dispatchEvent(new Event('unauthorized'));\n    }\n    return Promise.reject(error);\n  });\n};\n\n// Initialize on import\nconfigureAxios();","map":{"version":3,"names":["API_BASE","handleResponse","response","contentType","headers","get","errorData","includes","json","message","text","ok","error","Error","status","data","login","credentials","fetch","method","body","JSON","stringify","token","localStorage","setItem","console","register","userData","username","password","email","name","mobile","updateAccount","updates","getItem","user","currentData","parse","removeItem","window","dispatchEvent","Event","logout","getAuthToken","isAuthenticated","configureAxios","axios","defaults","common","interceptors","use","_error$response","Promise","reject"],"sources":["C:/MNNIT/SEM2/programmingLab2/Project/smartcity/smartCity/frontend/src/services/api.js"],"sourcesContent":["// frontend/src/services/api.js\r\nconst API_BASE = 'http://localhost:8000/api/auth';\r\n\r\n// Enhanced response handler\r\nconst handleResponse = async (response) => {\r\n  const contentType = response.headers.get('content-type');\r\n  let errorData;\r\n  \r\n  try {\r\n    errorData = contentType?.includes('application/json') \r\n      ? await response.json() \r\n      : { message: await response.text() };\r\n  } catch {\r\n    errorData = { message: 'Request failed' };\r\n  }\r\n\r\n  if (!response.ok) {\r\n    const error = new Error(errorData.message || `HTTP ${response.status}`);\r\n    error.status = response.status;\r\n    error.data = errorData;\r\n    throw error;\r\n  }\r\n\r\n  return errorData; // Returns parsed JSON for successful responses\r\n};\r\n\r\n// Auth Services\r\nexport const login = async (credentials) => {\r\n  try {\r\n    const response = await fetch(`${API_BASE}/login/`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(credentials),\r\n      credentials: 'include' // For session/cookie support if needed\r\n    });\r\n\r\n    const data = await handleResponse(response);\r\n    \r\n    if (!data.token) {\r\n      throw new Error('No token received from server');\r\n    }\r\n\r\n    localStorage.setItem('token', data.token);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Login failed:', error);\r\n    throw new Error(error.message || 'Login failed. Please try again.');\r\n  }\r\n};\r\n\r\nexport const register = async (userData) => {\r\n  try {\r\n    const response = await fetch(`${API_BASE}/register/`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        username: userData.username,\r\n        password: userData.password,\r\n        email: userData.email,\r\n        name: userData.name,\r\n        mobile: userData.mobile\r\n      })\r\n    });\r\n\r\n    return await handleResponse(response);\r\n  } catch (error) {\r\n    console.error('Registration failed:', error);\r\n    throw new Error(error.message || 'Registration failed. Please try again.');\r\n  }\r\n};\r\n\r\nexport const updateAccount = async (updates) => {\r\n  const token = localStorage.getItem('token');\r\n  if (!token) {\r\n    throw new Error('Authentication required. Please login.');\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`${API_BASE}/update/`, {\r\n      method: 'POST',\r\n      headers: { \r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Token ${token}`\r\n      },\r\n      body: JSON.stringify(updates)\r\n    });\r\n\r\n    const data = await handleResponse(response);\r\n    \r\n    // Update stored user data if needed\r\n    if (data.user) {\r\n      const currentData = JSON.parse(localStorage.getItem('userData') || {});\r\n      localStorage.setItem('userData', JSON.stringify({\r\n        ...currentData,\r\n        ...data.user\r\n      }));\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Update failed:', error);\r\n    \r\n    // Auto-logout on 401\r\n    if (error.status === 401) {\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('userData');\r\n      window.dispatchEvent(new Event('unauthorized'));\r\n    }\r\n\r\n    throw new Error(error.message || 'Failed to update account.');\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  const token = localStorage.getItem('token');\r\n  if (!token) return true;\r\n\r\n  try {\r\n    await fetch(`${API_BASE}/logout/`, {\r\n      method: 'POST',\r\n      headers: { \r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Token ${token}`\r\n      }\r\n    });\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Logout failed:', error);\r\n    return false;\r\n  } finally {\r\n    // Always clear client-side auth\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('userData');\r\n  }\r\n};\r\n\r\n// Auth state utilities\r\nexport const getAuthToken = () => localStorage.getItem('token');\r\n\r\nexport const isAuthenticated = () => !!getAuthToken();\r\n\r\n// Axios interceptor setup\r\nexport const configureAxios = () => {\r\n  const token = getAuthToken();\r\n  if (token) {\r\n    axios.defaults.headers.common['Authorization'] = `Token ${token}`;\r\n  }\r\n  \r\n  axios.interceptors.response.use(\r\n    response => response,\r\n    error => {\r\n      if (error.response?.status === 401) {\r\n        localStorage.removeItem('token');\r\n        window.dispatchEvent(new Event('unauthorized'));\r\n      }\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n};\r\n\r\n// Initialize on import\r\nconfigureAxios();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}