{"ast":null,"code":"import axios from 'axios';\nimport { getCountryCode } from '../utils/countryCodes';\nconst weatherApi = axios.create({\n  baseURL: 'https://api.openweathermap.org',\n  params: {\n    appid: 'f9293dbeda02be4bda1ce865b2706cb4'\n  },\n  timeout: 10000 // 10 second timeout\n});\nconst countriesApi = axios.create({\n  baseURL: 'https://restcountries.com/v3.1',\n  timeout: 10000\n});\n\n// Cache to prevent duplicate requests\nconst requestCache = new Map();\nexport const getCityCoordinates = async (city, country = '') => {\n  const cacheKey = `coordinates_${city}_${country}`;\n  try {\n    // Return cached result if available\n    if (requestCache.has(cacheKey)) {\n      return requestCache.get(cacheKey);\n    }\n    const countryCode = country ? getCountryCode(country) : '';\n\n    // Validate country code if country was provided\n    if (country && !countryCode) {\n      throw new Error('INVALID_COUNTRY');\n    }\n    let result;\n\n    // Country only - get capital\n    if (!city && countryCode) {\n      result = await getCountryCapital(countryCode);\n      const coords = await searchCityInCountry(result, countryCode);\n      requestCache.set(cacheKey, coords);\n      return coords;\n    }\n\n    // City + Country search\n    if (city && countryCode) {\n      result = await searchCityInCountry(city, countryCode);\n      requestCache.set(cacheKey, result);\n      return result;\n    }\n\n    // City only - global search\n    if (city) {\n      const {\n        data\n      } = await weatherApi.get('/geo/1.0/direct', {\n        params: {\n          q: city,\n          limit: 1\n        }\n      });\n      if (!data.length) throw new Error('CITY_NOT_FOUND');\n      result = {\n        lat: data[0].lat,\n        lon: data[0].lon\n      };\n      requestCache.set(cacheKey, result);\n      return result;\n    }\n    throw new Error('INVALID_INPUT');\n  } catch (error) {\n    // Cache errors to prevent retries\n    requestCache.set(cacheKey, {\n      error: error.message\n    });\n    throw error;\n  }\n};\nconst searchCityInCountry = async (city, countryCode) => {\n  const {\n    data\n  } = await weatherApi.get('/geo/1.0/direct', {\n    params: {\n      q: `${city},${countryCode}`,\n      limit: 1\n    }\n  });\n  if (!data.length) throw new Error('CITY_NOT_IN_COUNTRY');\n  return {\n    lat: data[0].lat,\n    lon: data[0].lon\n  };\n};\nexport const getCountryCapital = async countryCode => {\n  const {\n    data\n  } = await countriesApi.get(`/alpha/${countryCode.toLowerCase()}`);\n  if (!data.length || !data[0].capital) {\n    throw new Error('COUNTRY_NOT_FOUND');\n  }\n  return data[0].capital[0];\n};\nexport const getWeatherData = async (lat, lon) => {\n  const cacheKey = `weather_${lat}_${lon}`;\n  if (requestCache.has(cacheKey)) {\n    return requestCache.get(cacheKey);\n  }\n  const {\n    data\n  } = await weatherApi.get('/data/2.5/weather', {\n    params: {\n      lat,\n      lon,\n      units: 'metric'\n    }\n  });\n  requestCache.set(cacheKey, data);\n  return data;\n};","map":{"version":3,"names":["axios","getCountryCode","weatherApi","create","baseURL","params","appid","timeout","countriesApi","requestCache","Map","getCityCoordinates","city","country","cacheKey","has","get","countryCode","Error","result","getCountryCapital","coords","searchCityInCountry","set","data","q","limit","length","lat","lon","error","message","toLowerCase","capital","getWeatherData","units"],"sources":["C:/MNNIT/SEM2/programmingLab2/Project/smartcity/smartCity/frontend/src/services/weather.js"],"sourcesContent":["\r\nimport axios from 'axios';\r\nimport { getCountryCode } from '../utils/countryCodes';\r\n\r\nconst weatherApi = axios.create({\r\n  baseURL: 'https://api.openweathermap.org',\r\n  params: {\r\n    appid: 'f9293dbeda02be4bda1ce865b2706cb4'\r\n  },\r\n  timeout: 10000 // 10 second timeout\r\n});\r\n\r\nconst countriesApi = axios.create({\r\n  baseURL: 'https://restcountries.com/v3.1',\r\n  timeout: 10000\r\n});\r\n\r\n// Cache to prevent duplicate requests\r\nconst requestCache = new Map();\r\n\r\nexport const getCityCoordinates = async (city, country = '') => {\r\n  const cacheKey = `coordinates_${city}_${country}`;\r\n  \r\n  try {\r\n    // Return cached result if available\r\n    if (requestCache.has(cacheKey)) {\r\n      return requestCache.get(cacheKey);\r\n    }\r\n\r\n    const countryCode = country ? getCountryCode(country) : '';\r\n    \r\n    // Validate country code if country was provided\r\n    if (country && !countryCode) {\r\n      throw new Error('INVALID_COUNTRY');\r\n    }\r\n\r\n    let result;\r\n    \r\n    // Country only - get capital\r\n    if (!city && countryCode) {\r\n      result = await getCountryCapital(countryCode);\r\n      const coords = await searchCityInCountry(result, countryCode);\r\n      requestCache.set(cacheKey, coords);\r\n      return coords;\r\n    }\r\n\r\n    // City + Country search\r\n    if (city && countryCode) {\r\n      result = await searchCityInCountry(city, countryCode);\r\n      requestCache.set(cacheKey, result);\r\n      return result;\r\n    }\r\n\r\n    // City only - global search\r\n    if (city) {\r\n      const { data } = await weatherApi.get('/geo/1.0/direct', {\r\n        params: { q: city, limit: 1 }\r\n      });\r\n      \r\n      if (!data.length) throw new Error('CITY_NOT_FOUND');\r\n      \r\n      result = { lat: data[0].lat, lon: data[0].lon };\r\n      requestCache.set(cacheKey, result);\r\n      return result;\r\n    }\r\n\r\n    throw new Error('INVALID_INPUT');\r\n\r\n  } catch (error) {\r\n    // Cache errors to prevent retries\r\n    requestCache.set(cacheKey, { error: error.message });\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst searchCityInCountry = async (city, countryCode) => {\r\n  const { data } = await weatherApi.get('/geo/1.0/direct', {\r\n    params: { q: `${city},${countryCode}`, limit: 1 }\r\n  });\r\n  \r\n  if (!data.length) throw new Error('CITY_NOT_IN_COUNTRY');\r\n  return { lat: data[0].lat, lon: data[0].lon };\r\n};\r\n\r\nexport const getCountryCapital = async (countryCode) => {\r\n  const { data } = await countriesApi.get(`/alpha/${countryCode.toLowerCase()}`);\r\n  \r\n  if (!data.length || !data[0].capital) {\r\n    throw new Error('COUNTRY_NOT_FOUND');\r\n  }\r\n  \r\n  return data[0].capital[0];\r\n};\r\n\r\nexport const getWeatherData = async (lat, lon) => {\r\n  const cacheKey = `weather_${lat}_${lon}`;\r\n  \r\n  if (requestCache.has(cacheKey)) {\r\n    return requestCache.get(cacheKey);\r\n  }\r\n\r\n  const { data } = await weatherApi.get('/data/2.5/weather', {\r\n    params: { lat, lon, units: 'metric' }\r\n  });\r\n  \r\n  requestCache.set(cacheKey, data);\r\n  return data;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}