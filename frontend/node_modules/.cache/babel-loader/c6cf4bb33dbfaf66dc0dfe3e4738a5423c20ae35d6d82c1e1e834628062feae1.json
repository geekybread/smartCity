{"ast":null,"code":"var _jsxFileName = \"C:\\\\MNNIT\\\\SEM2\\\\programmingLab2\\\\Project\\\\smartcity\\\\smartCity\\\\frontend\\\\src\\\\components\\\\Alerts\\\\EmergencyBanner.js\",\n  _s = $RefreshSig$();\n// ✅ src/components/Alerts/EmergencyBanner.js\n\nimport React, { useEffect, useState } from 'react';\nimport api from '../../services/api';\nimport { useAuth } from '../../context/AuthContext';\nimport './EmergencyBanner.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EmergencyBanner = ({\n  city\n}) => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [alerts, setAlerts] = useState([]);\n  const [dismissedIds, setDismissedIds] = useState(new Set());\n  useEffect(() => {\n    if (!city) {\n      setAlerts([]);\n      return;\n    }\n    const fetchAlerts = async () => {\n      try {\n        const {\n          data\n        } = await api.get(`/api/emergency-alerts/?city=${encodeURIComponent(city)}`);\n        const now = new Date();\n        let list = data.filter(a => new Date(a.expiry_time) > now);\n        if (user) {\n          list = list.filter(a => !a.is_seen);\n          for (const a of list) {\n            await api.post(`/api/emergency-alerts/${a.id}/mark_seen/`).catch(() => {});\n          }\n        }\n        setAlerts(list);\n      } catch (err) {\n        console.error('Error fetching alerts:', err);\n      }\n    };\n    fetchAlerts();\n    const interval = setInterval(fetchAlerts, 30000);\n    return () => clearInterval(interval);\n  }, [city, user]);\n  const dismissAlert = id => {\n    setDismissedIds(prev => {\n      const next = new Set(prev).add(id);\n      if (!user) {\n        localStorage.setItem('dismissedAlerts', JSON.stringify([...next]));\n      }\n      return next;\n    });\n  };\n  if (!alerts.length) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"emergency-banner-container\",\n    children: alerts.filter(a => !dismissedIds.has(a.id)).map(alert => {\n      var _alert$level;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `emergency-banner ${((_alert$level = alert.level) === null || _alert$level === void 0 ? void 0 : _alert$level.toLowerCase()) || 'info'}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"alert-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: [alert.title || 'Alert', \":\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 15\n          }, this), \" \", alert.message]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 13\n        }, this), !user && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"dismiss-button\",\n          onClick: () => dismissAlert(alert.id),\n          children: \"\\u2716\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 15\n        }, this)]\n      }, alert.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 11\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 60,\n    columnNumber: 5\n  }, this);\n};\n_s(EmergencyBanner, \"Qu/Ho9g+CoXfgW4OXdL9yL67RHg=\", false, function () {\n  return [useAuth];\n});\n_c = EmergencyBanner;\nexport default EmergencyBanner;\nvar _c;\n$RefreshReg$(_c, \"EmergencyBanner\");","map":{"version":3,"names":["React","useEffect","useState","api","useAuth","jsxDEV","_jsxDEV","EmergencyBanner","city","_s","user","alerts","setAlerts","dismissedIds","setDismissedIds","Set","fetchAlerts","data","get","encodeURIComponent","now","Date","list","filter","a","expiry_time","is_seen","post","id","catch","err","console","error","interval","setInterval","clearInterval","dismissAlert","prev","next","add","localStorage","setItem","JSON","stringify","length","className","children","has","map","alert","_alert$level","level","toLowerCase","title","fileName","_jsxFileName","lineNumber","columnNumber","message","onClick","_c","$RefreshReg$"],"sources":["C:/MNNIT/SEM2/programmingLab2/Project/smartcity/smartCity/frontend/src/components/Alerts/EmergencyBanner.js"],"sourcesContent":["// ✅ src/components/Alerts/EmergencyBanner.js\r\n\r\nimport React, { useEffect, useState } from 'react'\r\nimport api from '../../services/api'\r\nimport { useAuth } from '../../context/AuthContext'\r\nimport './EmergencyBanner.css'\r\n\r\nconst EmergencyBanner = ({ city }) => {\r\n  const { user } = useAuth()\r\n  const [alerts, setAlerts] = useState([])\r\n  const [dismissedIds, setDismissedIds] = useState(new Set())\r\n\r\n  useEffect(() => {\r\n    if (!city) {\r\n      setAlerts([])\r\n      return\r\n    }\r\n\r\n    const fetchAlerts = async () => {\r\n      try {\r\n        const { data } = await api.get(\r\n          `/api/emergency-alerts/?city=${encodeURIComponent(city)}`\r\n        )\r\n\r\n        const now = new Date()\r\n        let list = data.filter(a => new Date(a.expiry_time) > now)\r\n\r\n        if (user) {\r\n          list = list.filter(a => !a.is_seen)\r\n          for (const a of list) {\r\n            await api.post(`/api/emergency-alerts/${a.id}/mark_seen/`).catch(() => {})\r\n          }\r\n        }\r\n\r\n        setAlerts(list)\r\n      } catch (err) {\r\n        console.error('Error fetching alerts:', err)\r\n      }\r\n    }\r\n\r\n    fetchAlerts()\r\n    const interval = setInterval(fetchAlerts, 30000)\r\n    return () => clearInterval(interval)\r\n  }, [city, user])\r\n\r\n  const dismissAlert = (id) => {\r\n    setDismissedIds(prev => {\r\n      const next = new Set(prev).add(id);\r\n      if (!user) {\r\n        localStorage.setItem('dismissedAlerts', JSON.stringify([...next]));\r\n      }\r\n      return next;\r\n    });\r\n  };\r\n  \r\n\r\n  if (!alerts.length) return null\r\n\r\n  return (\r\n    <div className=\"emergency-banner-container\">\r\n      {alerts\r\n        .filter(a => !dismissedIds.has(a.id))\r\n        .map(alert => (\r\n          <div\r\n            key={alert.id}\r\n            className={`emergency-banner ${alert.level?.toLowerCase() || 'info'}`}\r\n          >\r\n            <div className=\"alert-content\">\r\n              <strong>{alert.title || 'Alert'}:</strong> {alert.message}\r\n            </div>\r\n            {!user && (\r\n              <button className=\"dismiss-button\" onClick={() => dismissAlert(alert.id)}>\r\n                ✖\r\n              </button>\r\n            )}\r\n          </div>\r\n        ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default EmergencyBanner\r\n"],"mappings":";;AAAA;;AAEA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,OAAOC,GAAG,MAAM,oBAAoB;AACpC,SAASC,OAAO,QAAQ,2BAA2B;AACnD,OAAO,uBAAuB;AAAA,SAAAC,MAAA,IAAAC,OAAA;AAE9B,MAAMC,eAAe,GAAGA,CAAC;EAAEC;AAAK,CAAC,KAAK;EAAAC,EAAA;EACpC,MAAM;IAAEC;EAAK,CAAC,GAAGN,OAAO,CAAC,CAAC;EAC1B,MAAM,CAACO,MAAM,EAAEC,SAAS,CAAC,GAAGV,QAAQ,CAAC,EAAE,CAAC;EACxC,MAAM,CAACW,YAAY,EAAEC,eAAe,CAAC,GAAGZ,QAAQ,CAAC,IAAIa,GAAG,CAAC,CAAC,CAAC;EAE3Dd,SAAS,CAAC,MAAM;IACd,IAAI,CAACO,IAAI,EAAE;MACTI,SAAS,CAAC,EAAE,CAAC;MACb;IACF;IAEA,MAAMI,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACF,MAAM;UAAEC;QAAK,CAAC,GAAG,MAAMd,GAAG,CAACe,GAAG,CAC5B,+BAA+BC,kBAAkB,CAACX,IAAI,CAAC,EACzD,CAAC;QAED,MAAMY,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC;QACtB,IAAIC,IAAI,GAAGL,IAAI,CAACM,MAAM,CAACC,CAAC,IAAI,IAAIH,IAAI,CAACG,CAAC,CAACC,WAAW,CAAC,GAAGL,GAAG,CAAC;QAE1D,IAAIV,IAAI,EAAE;UACRY,IAAI,GAAGA,IAAI,CAACC,MAAM,CAACC,CAAC,IAAI,CAACA,CAAC,CAACE,OAAO,CAAC;UACnC,KAAK,MAAMF,CAAC,IAAIF,IAAI,EAAE;YACpB,MAAMnB,GAAG,CAACwB,IAAI,CAAC,yBAAyBH,CAAC,CAACI,EAAE,aAAa,CAAC,CAACC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;UAC5E;QACF;QAEAjB,SAAS,CAACU,IAAI,CAAC;MACjB,CAAC,CAAC,OAAOQ,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,wBAAwB,EAAEF,GAAG,CAAC;MAC9C;IACF,CAAC;IAEDd,WAAW,CAAC,CAAC;IACb,MAAMiB,QAAQ,GAAGC,WAAW,CAAClB,WAAW,EAAE,KAAK,CAAC;IAChD,OAAO,MAAMmB,aAAa,CAACF,QAAQ,CAAC;EACtC,CAAC,EAAE,CAACzB,IAAI,EAAEE,IAAI,CAAC,CAAC;EAEhB,MAAM0B,YAAY,GAAIR,EAAE,IAAK;IAC3Bd,eAAe,CAACuB,IAAI,IAAI;MACtB,MAAMC,IAAI,GAAG,IAAIvB,GAAG,CAACsB,IAAI,CAAC,CAACE,GAAG,CAACX,EAAE,CAAC;MAClC,IAAI,CAAClB,IAAI,EAAE;QACT8B,YAAY,CAACC,OAAO,CAAC,iBAAiB,EAAEC,IAAI,CAACC,SAAS,CAAC,CAAC,GAAGL,IAAI,CAAC,CAAC,CAAC;MACpE;MACA,OAAOA,IAAI;IACb,CAAC,CAAC;EACJ,CAAC;EAGD,IAAI,CAAC3B,MAAM,CAACiC,MAAM,EAAE,OAAO,IAAI;EAE/B,oBACEtC,OAAA;IAAKuC,SAAS,EAAC,4BAA4B;IAAAC,QAAA,EACxCnC,MAAM,CACJY,MAAM,CAACC,CAAC,IAAI,CAACX,YAAY,CAACkC,GAAG,CAACvB,CAAC,CAACI,EAAE,CAAC,CAAC,CACpCoB,GAAG,CAACC,KAAK;MAAA,IAAAC,YAAA;MAAA,oBACR5C,OAAA;QAEEuC,SAAS,EAAE,oBAAoB,EAAAK,YAAA,GAAAD,KAAK,CAACE,KAAK,cAAAD,YAAA,uBAAXA,YAAA,CAAaE,WAAW,CAAC,CAAC,KAAI,MAAM,EAAG;QAAAN,QAAA,gBAEtExC,OAAA;UAAKuC,SAAS,EAAC,eAAe;UAAAC,QAAA,gBAC5BxC,OAAA;YAAAwC,QAAA,GAASG,KAAK,CAACI,KAAK,IAAI,OAAO,EAAC,GAAC;UAAA;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAACR,KAAK,CAACS,OAAO;QAAA;UAAAJ,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACtD,CAAC,EACL,CAAC/C,IAAI,iBACJJ,OAAA;UAAQuC,SAAS,EAAC,gBAAgB;UAACc,OAAO,EAAEA,CAAA,KAAMvB,YAAY,CAACa,KAAK,CAACrB,EAAE,CAAE;UAAAkB,QAAA,EAAC;QAE1E;UAAAQ,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CACT;MAAA,GAVIR,KAAK,CAACrB,EAAE;QAAA0B,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAWV,CAAC;IAAA,CACP;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACD,CAAC;AAEV,CAAC;AAAAhD,EAAA,CAxEKF,eAAe;EAAA,QACFH,OAAO;AAAA;AAAAwD,EAAA,GADpBrD,eAAe;AA0ErB,eAAeA,eAAe;AAAA,IAAAqD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}