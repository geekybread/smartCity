{"ast":null,"code":"var _jsxFileName = \"C:\\\\MNNIT\\\\SEM2\\\\programmingLab2\\\\Project\\\\smartcity\\\\smartCity\\\\frontend\\\\src\\\\components\\\\Auth\\\\PhoneVerificationModal.js\",\n  _s = $RefreshSig$();\n// src/components/Auth/PhoneVerificationModal.js\nimport React, { useState } from 'react';\nimport './PhoneVerificationModal.css'; // optional styling\nimport axios from 'axios';\nimport { useAuth } from '../../context/AuthContext';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function PhoneVerificationModal({\n  isOpen,\n  onClose,\n  onVerified\n}) {\n  _s();\n  const [step, setStep] = useState('phone'); // 'phone' | 'otp'\n  const [phone, setPhone] = useState('');\n  const [otp, setOtp] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const {\n    logout\n  } = useAuth();\n  if (!isOpen) return null;\n  const handleStartVerification = async () => {\n    setError(null);\n    setLoading(true);\n    try {\n      await axios.post('/api/accounts/verify/start/', {\n        phone\n      });\n      setStep('otp');\n    } catch (err) {\n      var _err$response, _err$response$data;\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.error) || 'Failed to start verification');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleVerifyOtp = async () => {\n    setError(null);\n    setLoading(true);\n    try {\n      const res = await axios.post('/api/accounts/verify/check/', {\n        phone,\n        code: otp\n      });\n      if (res.data.verified) {\n        onVerified();\n        onClose();\n      } else {\n        setError('Invalid OTP');\n      }\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      setError(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.error) || 'Failed to verify OTP');\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"phone-verification-backdrop\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"phone-verification-modal\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"\\uD83D\\uDCF1 Verify Your Phone\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 9\n      }, this), step === 'phone' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Enter your phone number (with country code):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"tel\",\n          value: phone,\n          onChange: e => setPhone(e.target.value),\n          placeholder: \"+919876543210\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleStartVerification,\n          disabled: loading,\n          children: loading ? 'Sending...' : 'Send OTP'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 64,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: [\"Enter the OTP sent to \", phone, \":\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: otp,\n          onChange: e => setOtp(e.target.value),\n          placeholder: \"123456\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleVerifyOtp,\n          disabled: loading,\n          children: loading ? 'Verifying...' : 'Verify'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: logout,\n        style: {\n          marginTop: '1rem',\n          background: 'transparent',\n          color: '#ff4d4f',\n          border: 'none',\n          textDecoration: 'underline',\n          cursor: 'pointer',\n          fontSize: '0.9rem'\n        },\n        children: \"Log out instead\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 51,\n    columnNumber: 5\n  }, this);\n}\n_s(PhoneVerificationModal, \"8KJ9bGJ/MfDGuBDEbWHIlUk94wM=\", false, function () {\n  return [useAuth];\n});\n_c = PhoneVerificationModal;\nvar _c;\n$RefreshReg$(_c, \"PhoneVerificationModal\");","map":{"version":3,"names":["React","useState","axios","useAuth","jsxDEV","_jsxDEV","Fragment","_Fragment","PhoneVerificationModal","isOpen","onClose","onVerified","_s","step","setStep","phone","setPhone","otp","setOtp","loading","setLoading","error","setError","logout","handleStartVerification","post","err","_err$response","_err$response$data","response","data","handleVerifyOtp","res","code","verified","_err$response2","_err$response2$data","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","value","onChange","e","target","placeholder","onClick","disabled","style","marginTop","background","color","border","textDecoration","cursor","fontSize","_c","$RefreshReg$"],"sources":["C:/MNNIT/SEM2/programmingLab2/Project/smartcity/smartCity/frontend/src/components/Auth/PhoneVerificationModal.js"],"sourcesContent":["// src/components/Auth/PhoneVerificationModal.js\r\nimport React, { useState } from 'react';\r\nimport './PhoneVerificationModal.css'; // optional styling\r\nimport axios from 'axios';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\n\r\nexport default function PhoneVerificationModal({ isOpen, onClose, onVerified }) {\r\n  const [step, setStep] = useState('phone'); // 'phone' | 'otp'\r\n  const [phone, setPhone] = useState('');\r\n  const [otp, setOtp] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const { logout } = useAuth();\r\n\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleStartVerification = async () => {\r\n    setError(null);\r\n    setLoading(true);\r\n    try {\r\n      await axios.post('/api/accounts/verify/start/', { phone });\r\n      setStep('otp');\r\n    } catch (err) {\r\n      setError(err.response?.data?.error || 'Failed to start verification');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleVerifyOtp = async () => {\r\n    setError(null);\r\n    setLoading(true);\r\n    try {\r\n      const res = await axios.post('/api/accounts/verify/check/', { phone, code: otp });\r\n      if (res.data.verified) {\r\n        onVerified();\r\n        onClose();\r\n      } else {\r\n        setError('Invalid OTP');\r\n      }\r\n    } catch (err) {\r\n      setError(err.response?.data?.error || 'Failed to verify OTP');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"phone-verification-backdrop\">\r\n      <div className=\"phone-verification-modal\">\r\n        <h2>ðŸ“± Verify Your Phone</h2>\r\n\r\n        {step === 'phone' ? (\r\n          <>\r\n            <label>Enter your phone number (with country code):</label>\r\n            <input\r\n              type=\"tel\"\r\n              value={phone}\r\n              onChange={e => setPhone(e.target.value)}\r\n              placeholder=\"+919876543210\"\r\n            />\r\n            <button onClick={handleStartVerification} disabled={loading}>\r\n              {loading ? 'Sending...' : 'Send OTP'}\r\n            </button>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <label>Enter the OTP sent to {phone}:</label>\r\n            <input\r\n              type=\"text\"\r\n              value={otp}\r\n              onChange={e => setOtp(e.target.value)}\r\n              placeholder=\"123456\"\r\n            />\r\n            <button onClick={handleVerifyOtp} disabled={loading}>\r\n              {loading ? 'Verifying...' : 'Verify'}\r\n            </button>\r\n          </>\r\n        )}\r\n\r\n        <button\r\n        onClick={logout}\r\n        style={{\r\n            marginTop: '1rem',\r\n            background: 'transparent',\r\n            color: '#ff4d4f',\r\n            border: 'none',\r\n            textDecoration: 'underline',\r\n            cursor: 'pointer',\r\n            fontSize: '0.9rem'\r\n        }}\r\n        >\r\n        Log out instead\r\n        </button>\r\n\r\n\r\n        {error && <div className=\"error\">{error}</div>}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}