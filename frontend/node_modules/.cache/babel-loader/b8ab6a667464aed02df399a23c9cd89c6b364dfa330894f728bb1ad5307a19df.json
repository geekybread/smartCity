{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useCallback, useRef } from 'react';\nimport { getCityCoordinates, getWeatherData, getAirQualityData } from '../../../services/weather';\nimport api from '../../../services/api';\nexport default function useMapData(city, country, user) {\n  _s();\n  const [weather, setWeather] = useState(null);\n  const [airQuality, setAirQuality] = useState(null);\n  const [markers, setMarkers] = useState([]);\n  const prevSearchRef = useRef('');\n  const updateMarkers = useCallback(data => {\n    const newMarkers = data.map(f => ({\n      id: f.id,\n      position: {\n        lat: typeof f.latitude === 'number' ? f.latitude : parseFloat(f.latitude),\n        lng: typeof f.longitude === 'number' ? f.longitude : parseFloat(f.longitude)\n      },\n      type: f.issue_type || f.issueType,\n      severity: f.severity\n    }));\n    setMarkers(newMarkers);\n  }, []);\n  const fetchData = useCallback(async () => {\n    if (!city && !country) return {\n      center: null,\n      zoom: null\n    };\n    const key = `${city === null || city === void 0 ? void 0 : city.trim().toLowerCase()}|${country === null || country === void 0 ? void 0 : country.trim().toLowerCase()}`;\n    prevSearchRef.current = key;\n    try {\n      const {\n        lat,\n        lon\n      } = await getCityCoordinates(city, country);\n      const weatherData = await getWeatherData(lat, lon);\n      const airQualityData = await getAirQualityData(lat, lon).catch(() => null);\n      setWeather(weatherData);\n      setAirQuality(airQualityData);\n\n      // Fetch feedbacks just to update markers (not sidebar list)\n      try {\n        const resp = await api.get(`/api/feedback/?city=${encodeURIComponent(city)}`, {\n          headers: user ? {\n            Authorization: `Token ${localStorage.getItem('token')}`\n          } : {}\n        });\n        updateMarkers(resp.data);\n      } catch (err) {\n        console.error('Marker update feedback fetch failed:', err);\n        setMarkers([]);\n      }\n      return {\n        center: {\n          lat,\n          lng: lon\n        },\n        zoom: city ? 13 : 6\n      };\n    } catch (error) {\n      console.error('Error:', error);\n      let message;\n      switch (error.message) {\n        case 'CITY_NOT_FOUND':\n          message = `${city} not found${country ? ` in ${country}` : ''}`;\n          break;\n        case 'CITY_NOT_IN_COUNTRY':\n          message = `${city} not found in ${country}`;\n          break;\n        case 'COUNTRY_NOT_FOUND':\n          message = `${country} not found`;\n          break;\n        case 'INVALID_COUNTRY':\n          message = `Invalid country: ${country}`;\n          break;\n        default:\n          message = 'Failed to load location data';\n      }\n      return {\n        error: true,\n        message\n      };\n    }\n  }, [city, country, updateMarkers, user]);\n  const addFeedback = async newFeedback => {\n    try {\n      const response = await api.post('/api/feedback/', newFeedback, {\n        headers: {\n          Authorization: `Token ${localStorage.getItem('token')}`\n        }\n      });\n\n      // Add new marker only for display\n      const newMarker = {\n        id: response.data.id,\n        position: {\n          lat: parseFloat(response.data.latitude),\n          lng: parseFloat(response.data.longitude)\n        },\n        type: response.data.issue_type,\n        severity: response.data.severity\n      };\n      setMarkers(prev => [newMarker, ...prev]);\n    } catch (err) {\n      console.error('Error submitting feedback:', err);\n    }\n  };\n  return {\n    weather,\n    airQuality,\n    markers,\n    fetchData,\n    addFeedback\n  };\n}\n_s(useMapData, \"tZb0LwJjs6qpZA5bYSkkF0lUMWM=\");","map":{"version":3,"names":["useState","useCallback","useRef","getCityCoordinates","getWeatherData","getAirQualityData","api","useMapData","city","country","user","_s","weather","setWeather","airQuality","setAirQuality","markers","setMarkers","prevSearchRef","updateMarkers","data","newMarkers","map","f","id","position","lat","latitude","parseFloat","lng","longitude","type","issue_type","issueType","severity","fetchData","center","zoom","key","trim","toLowerCase","current","lon","weatherData","airQualityData","catch","resp","get","encodeURIComponent","headers","Authorization","localStorage","getItem","err","console","error","message","addFeedback","newFeedback","response","post","newMarker","prev"],"sources":["C:/MNNIT/SEM2/programmingLab2/Project/smartcity/smartCity/frontend/src/components/Map/hooks/useMapData.js"],"sourcesContent":["import { useState, useCallback, useRef } from 'react';\r\nimport { getCityCoordinates, getWeatherData, getAirQualityData } from '../../../services/weather';\r\nimport api from '../../../services/api';\r\n\r\nexport default function useMapData(city, country, user) {\r\n  const [weather, setWeather] = useState(null);\r\n  const [airQuality, setAirQuality] = useState(null);\r\n  const [markers, setMarkers] = useState([]);\r\n  const prevSearchRef = useRef('');\r\n\r\n  const updateMarkers = useCallback(data => {\r\n    const newMarkers = data.map(f => ({\r\n      id: f.id,\r\n      position: {\r\n        lat: typeof f.latitude === 'number' ? f.latitude : parseFloat(f.latitude),\r\n        lng: typeof f.longitude === 'number' ? f.longitude : parseFloat(f.longitude)\r\n      },\r\n      type: f.issue_type || f.issueType,\r\n      severity: f.severity\r\n    }));\r\n    setMarkers(newMarkers);\r\n  }, []);\r\n\r\n  const fetchData = useCallback(async () => {\r\n    if (!city && !country) return { center: null, zoom: null };\r\n\r\n    const key = `${city?.trim().toLowerCase()}|${country?.trim().toLowerCase()}`;\r\n    prevSearchRef.current = key;\r\n\r\n    try {\r\n      const { lat, lon } = await getCityCoordinates(city, country);\r\n      const weatherData = await getWeatherData(lat, lon);\r\n      const airQualityData = await getAirQualityData(lat, lon).catch(() => null);\r\n\r\n      setWeather(weatherData);\r\n      setAirQuality(airQualityData);\r\n\r\n      // Fetch feedbacks just to update markers (not sidebar list)\r\n      try {\r\n        const resp = await api.get(`/api/feedback/?city=${encodeURIComponent(city)}`, {\r\n          headers: user ? { Authorization: `Token ${localStorage.getItem('token')}` } : {}\r\n        });\r\n        updateMarkers(resp.data);\r\n      } catch (err) {\r\n        console.error('Marker update feedback fetch failed:', err);\r\n        setMarkers([]);\r\n      }\r\n\r\n      return { center: { lat, lng: lon }, zoom: city ? 13 : 6 };\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      let message;\r\n      switch (error.message) {\r\n        case 'CITY_NOT_FOUND':\r\n          message = `${city} not found${country ? ` in ${country}` : ''}`;\r\n          break;\r\n        case 'CITY_NOT_IN_COUNTRY':\r\n          message = `${city} not found in ${country}`;\r\n          break;\r\n        case 'COUNTRY_NOT_FOUND':\r\n          message = `${country} not found`;\r\n          break;\r\n        case 'INVALID_COUNTRY':\r\n          message = `Invalid country: ${country}`;\r\n          break;\r\n        default:\r\n          message = 'Failed to load location data';\r\n      }\r\n      return { error: true, message };\r\n    }\r\n  }, [city, country, updateMarkers, user]);\r\n\r\n  const addFeedback = async (newFeedback) => {\r\n    try {\r\n      const response = await api.post('/api/feedback/', newFeedback, {\r\n        headers: { Authorization: `Token ${localStorage.getItem('token')}` }\r\n      });\r\n\r\n      // Add new marker only for display\r\n      const newMarker = {\r\n        id: response.data.id,\r\n        position: {\r\n          lat: parseFloat(response.data.latitude),\r\n          lng: parseFloat(response.data.longitude)\r\n        },\r\n        type: response.data.issue_type,\r\n        severity: response.data.severity\r\n      };\r\n      setMarkers(prev => [newMarker, ...prev]);\r\n    } catch (err) {\r\n      console.error('Error submitting feedback:', err);\r\n    }\r\n  };\r\n\r\n  return { weather, airQuality, markers, fetchData, addFeedback };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}