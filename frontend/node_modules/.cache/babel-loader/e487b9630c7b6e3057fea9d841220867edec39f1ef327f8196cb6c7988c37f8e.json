{"ast":null,"code":"var _jsxFileName = \"C:\\\\MNNIT\\\\SEM2\\\\programmingLab2\\\\Project\\\\smartcity\\\\smartCity\\\\frontend\\\\src\\\\components\\\\Alerts\\\\EmergencyBanner.js\",\n  _s = $RefreshSig$();\n// src/components/Alerts/EmergencyBanner.js\n\nimport React, { useEffect, useState } from 'react';\nimport api from '../../services/api';\nimport { useAuth } from '../../context/AuthContext';\nimport './EmergencyBannerX.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EmergencyBanner = ({\n  city\n}) => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [alerts, setAlerts] = useState([]);\n  const [dismissedIds, setDismissedIds] = useState(new Set());\n  useEffect(() => {\n    if (!city) {\n      setAlerts([]);\n      return;\n    }\n    const fetchAlerts = async () => {\n      try {\n        const {\n          data\n        } = await api.get(`/api/emergency-alerts/?city=${encodeURIComponent(city)}`);\n        const now = new Date();\n        let list = data.filter(a => new Date(a.expiry_time) > now);\n        if (user) {\n          // logged‐in: show only unseen and mark them seen\n          list = list.filter(a => !a.is_seen);\n          list.forEach(a => api.post(`/api/emergency-alerts/${a.id}/mark_seen/`).catch(() => {}));\n        }\n        setAlerts(list);\n      } catch (err) {\n        console.error('Error fetching alerts:', err);\n        setAlerts([]);\n      }\n    };\n    fetchAlerts();\n    const iv = setInterval(fetchAlerts, 30000);\n    return () => clearInterval(iv);\n  }, [city, user]);\n  const dismissAlert = id => {\n    if (!user) {\n      // guest: dismiss only in‐memory (resets on page refresh)\n      setDismissedIds(prev => new Set(prev).add(id));\n    }\n  };\n  if (!alerts.length) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"emergency-banner-container\",\n    children: alerts.filter(alert => !dismissedIds.has(alert.id)).map(alert => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `emergency-banner ${alert.level || ''}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"alert-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: [alert.title || 'Alert', \":\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 15\n        }, this), \" \", alert.message]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 13\n      }, this), !user && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"dismiss-button\",\n        onClick: () => dismissAlert(alert.id),\n        children: \"\\u2716\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 15\n      }, this)]\n    }, alert.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 11\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 5\n  }, this);\n};\n_s(EmergencyBanner, \"Qu/Ho9g+CoXfgW4OXdL9yL67RHg=\", false, function () {\n  return [useAuth];\n});\n_c = EmergencyBanner;\nexport default EmergencyBanner;\nvar _c;\n$RefreshReg$(_c, \"EmergencyBanner\");","map":{"version":3,"names":["React","useEffect","useState","api","useAuth","jsxDEV","_jsxDEV","EmergencyBanner","city","_s","user","alerts","setAlerts","dismissedIds","setDismissedIds","Set","fetchAlerts","data","get","encodeURIComponent","now","Date","list","filter","a","expiry_time","is_seen","forEach","post","id","catch","err","console","error","iv","setInterval","clearInterval","dismissAlert","prev","add","length","className","children","alert","has","map","level","title","fileName","_jsxFileName","lineNumber","columnNumber","message","onClick","_c","$RefreshReg$"],"sources":["C:/MNNIT/SEM2/programmingLab2/Project/smartcity/smartCity/frontend/src/components/Alerts/EmergencyBanner.js"],"sourcesContent":["// src/components/Alerts/EmergencyBanner.js\r\n\r\nimport React, { useEffect, useState } from 'react'\r\nimport api from '../../services/api'\r\nimport { useAuth } from '../../context/AuthContext'\r\nimport './EmergencyBannerX.css'\r\n\r\nconst EmergencyBanner = ({ city }) => {\r\n  const { user } = useAuth()\r\n  const [alerts, setAlerts] = useState([])\r\n  const [dismissedIds, setDismissedIds] = useState(new Set())\r\n\r\n  useEffect(() => {\r\n    if (!city) {\r\n      setAlerts([])\r\n      return\r\n    }\r\n    const fetchAlerts = async () => {\r\n      try {\r\n        const { data } = await api.get(\r\n          `/api/emergency-alerts/?city=${encodeURIComponent(city)}`\r\n        )\r\n        const now = new Date()\r\n        let list = data.filter(a => new Date(a.expiry_time) > now)\r\n\r\n        if (user) {\r\n          // logged‐in: show only unseen and mark them seen\r\n          list = list.filter(a => !a.is_seen)\r\n          list.forEach(a =>\r\n            api.post(`/api/emergency-alerts/${a.id}/mark_seen/`).catch(() => {})\r\n          )\r\n        }\r\n\r\n        setAlerts(list)\r\n      } catch (err) {\r\n        console.error('Error fetching alerts:', err)\r\n        setAlerts([])\r\n      }\r\n    }\r\n\r\n    fetchAlerts()\r\n    const iv = setInterval(fetchAlerts, 30000)\r\n    return () => clearInterval(iv)\r\n  }, [city, user])\r\n\r\n  const dismissAlert = id => {\r\n    if (!user) {\r\n      // guest: dismiss only in‐memory (resets on page refresh)\r\n      setDismissedIds(prev => new Set(prev).add(id))\r\n    }\r\n  }\r\n\r\n  if (!alerts.length) return null\r\n\r\n  return (\r\n    <div className=\"emergency-banner-container\">\r\n      {alerts\r\n        .filter(alert => !dismissedIds.has(alert.id))\r\n        .map(alert => (\r\n          <div key={alert.id} className={`emergency-banner ${alert.level || ''}`}>\r\n            <div className=\"alert-content\">\r\n              <strong>{alert.title || 'Alert'}:</strong> {alert.message}\r\n            </div>\r\n            {!user && (\r\n              <button\r\n                className=\"dismiss-button\"\r\n                onClick={() => dismissAlert(alert.id)}\r\n              >\r\n                ✖\r\n              </button>\r\n            )}\r\n          </div>\r\n        ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default EmergencyBanner\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}